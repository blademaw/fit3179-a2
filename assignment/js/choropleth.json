{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Median Airbnb nightly costs across Melbourne LGAs",
    "vconcat": [{
            "autosize": {
                "type": "fit",
                "contains": "padding"
            },
            "projection": {
                "type": "equirectangular"
            },
            "width": 750,
            "height": 400,
            "layer": [{
                    "params": [{
                            "name": "highlight",
                            "select": {
                                "type": "point",
                                "on": "mouseover"
                            }
                        },
                        {
                            "name": "select",
                            "select": {
                                "type": "point",
                                "fields": ["properties.ABB_NAME"]
                            }
                        },
                        {
                            "name": "s-box",
                            "values": [{
                                "properties.ABB_NAME": "Whittlesea"
                            }],
                            "select": {
                                "type": "point",
                                "fields": ["properties.ABB_NAME"]
                            }
                        }
                    ],
                    "data": {
                        "url": "../data/vic_lga.json",
                        "format": {
                            "type": "topojson",
                            "feature": "vic_lga"
                        }
                    },
                    "transform": [{
                            "lookup": "properties.ABB_NAME",
                            "from": {
                                "data": {
                                    "url": "../data/listings_agg.csv",
                                    "format": {
                                        "type": "csv"
                                    }
                                },
                                "key": "city",
                                "fields": ["num_listings", "population", "med_price"]
                            }
                        },
                        {
                            "calculate": "datum.num_listings*100/datum.population",
                            "as": "norm_listings"
                        }
                    ],
                    "mark": {
                        "type": "geoshape"
                    },
                    "encoding": {
                        "color": {
                            "field": "norm_listings",
                            "type": "quantitative",
                            "title": "Number of listings per 100 people",
                            "scale": {
                                "scheme": "browns",
                                "type": "threshold",
                                "domain": [0.2, 1, 2]
                            },
                            "legend": {
                                "offset": -125,
                                "orient": "left"
                            }
                        },
                        "fillOpacity": {
                            "condition": [{
                                "param": "select",
                                "value": 1
                            }],
                            "value": 0.4
                        },
                        "stroke": {
                            "condition": {
                                "param": "select",
                                "value": "#858585"
                            },
                            "value": "#D8D8D8"
                        },
                        "tooltip": [{
                                "field": "properties.ABB_NAME",
                                "type": "nominal",
                                "title": "LGA"
                            },
                            {
                                "field": "norm_listings",
                                "type": "quantitative",
                                "title": "Number of listings per 100 people",
                                "format": ".01"
                            },
                            {
                                "field": "med_price",
                                "type": "quantitative",
                                "title": "Median nightly rent",
                                "format": "$d"
                            }
                        ],
                        "strokeWidth": {
                            "condition": [{
                                    "param": "select",
                                    "empty": false,
                                    "value": 2
                                },
                                {
                                    "param": "highlight",
                                    "empty": false,
                                    "value": 1.2
                                }
                            ],
                            "value": 0.4
                        }
                    }
                },
                {
                    
                    "data": {
                        "url": "../data/listings_agg.csv",
                        "format": {
                            "type": "csv"
                        }
                    },
                    "mark": {
                        "type": "circle",
                        "color": "grey",
                        "opacity": 0.8
                    },
                    "encoding": {
                        "longitude": {
                            "field": "mean_long",
                            "type": "quantitative"
                        },
                        "latitude": {
                            "field": "mean_lat",
                            "type": "quantitative"
                        },
                        "size": {
                            "field": "med_price",
                            "type": "quantitative",
                            "legend": {
                                "offset": -125,
                                "orient": "left",
                                "format": "$f"
                            }
                        }
                    }
                }
            ]
        },
        {
            "hconcat": [{
                    "vconcat": [{
                            "width": 400,
                            "height": 225,
                            "data": {
                                "url": "../data/vic_lga.json",
                                "format": {
                                    "type": "topojson",
                                    "feature": "vic_lga"
                                }
                            },
                            "transform": [{
                                "lookup": "properties.ABB_NAME",
                                "from": {
                                    "data": {
                                        "url": "../data/listings_agg.csv",
                                        "format": {
                                            "type": "csv"
                                        }
                                    },
                                    "key": "city",
                                    "fields": ["num_listings", "population", "med_price"]
                                }
                            }],
                            "layer": [{
                                    "mark": {
                                        "type": "point",
                                        "color": {
                                            "value": "grey"
                                        },
                                        "opacity": 1,
                                        "size": 100
                                    },
                                    "encoding": {
                                        "x": {
                                            "field": "num_listings",
                                            "type": "quantitative"
                                        },
                                        "y": {
                                            "field": "population",
                                            "type": "quantitative"
                                        }
                                    }
                                },
                                {
                                    "params": [
                                    {
                                        "name": "select",
                                        "select": {
                                            "type": "interval",
                                            "fields": ["properties.ABB_NAME"]
                                        }
                                    }
                                ],
                                    "transform": [{
                                        "filter": {
                                            "selection": "select"
                                        }
                                    }],
                                    "mark": {
                                        "type": "point",
                                        "color": "brown",
                                        "size": 100,
                                        "opacity": 1
                                    },
                                    "encoding": {
                                        "x": {
                                            "field": "num_listings",
                                            "type": "quantitative",
                                            "scale": {
                                                "type": "linear"
                                            },
                                            "title": "Total number of Listings"
                                        },
                                        "y": {
                                            "field": "population",
                                            "type": "quantitative",
                                            "title": "Population (2018)"
                                        },
                                        "tooltip": [{
                                            "field": "properties.ABB_NAME",
                                            "title": "LGA",
                                            "type": "nominal"
                                        }]
                                    }
                                }
                            ]
                        },
                        {
                            "width": 400,
                            "height": 225,
                            "data": {
                                "url": "../data/listings_agg.csv",
                                "format": {
                                    "type": "csv"
                                }
                            },
                            "mark": {
                                "type": "bar",
                                "color": "brown",
                                "opacity": 1
                            },
                            "encoding": {
                                "x": {
                                    "field": "city",
                                    "type": "nominal",
                                    "title": "LGA",
                                    "sort": {"field": "med_price", "type": "quantitative"}
                                },
                                "y": {
                                    "field": "med_price",
                                    "type": "quantitative",
                                    "title": "Median weekly price"
                                },
                                "fillOpacity": {
                                    "condition": [{
                                        "param": "select",
                                        "value": 1
                                    }],
                                    "value": 0.4
                                }
                            }
                        }
                    ]
                },
                {
                    "width": 200,
                    "autosize": {
                        "type": "pad"
                    },
                    "data": {
                        "url": "../data/revised_cleansed_listings.csv",
                        "format": {
                            "type": "csv"
                        }
                    },
                    "transform": [{
                        "lookup": "city",
                        "from": {
                            "data": {
                                "url": "../data/listings_agg.csv",
                                "format": {
                                    "type": "csv"
                                }
                            },
                            "key": "city",
                            "fields": ["num_listings", "population", "med_price"]
                        }
                    },
                    {
                        "filter": {
                            "selection": "s-box"
                        }
                    }],
                    "mark": {
                        "type": "boxplot",
                        "extent": "min-max"
                    },
                    "encoding": {
                        "x": {
                            "field": "weekly_price",
                            "type": "quantitative",
                            "title": "Weekly rent price ($)"
                        },
                        "y": {
                            "field": "city",
                            "type": "nominal",
                            "title": "LGA",
                            "sort": {"field": "med_price", "aggregate": "median", "order": "ascending"}
                        }
                    }
                }
            ]
        }
    ]
}